<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <title>PHPUnit マニュアル &#8211; 第7章 不完全なテスト・テストの省略</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="canonical" href="incomplete-and-skipped-tests.html">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/highlight.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700%7CSource+Code+Pro:400,700' rel='stylesheet' type='text/css'>
  <!--[if lt IE 9]><script src="js/html5shiv.min.js"></script><![endif]-->
 </head>
 <body>
  
  <div class="container-fluid">
   <div class="row">
    <div style='padding: 2.0em'>
     <div class="row">
      <div class="col-md-1 pull-left prev-nav"><a accesskey="p" href="strict-mode.html">戻る</a></div>
      <div class="col-md-1 pull-right next-nav"><a accesskey="n" href="database.html">次へ</a></div>
     </div>
<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="incomplete-and-skipped-tests"></a>第7章 不完全なテスト・テストの省略</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="incomplete-and-skipped-tests.incomplete-tests"></a>不完全なテスト</h2></div></div></div><p>
      新しいテストケースクラスを作成する際には、
      これから書くべきテストの内容をはっきりさせるために、
      まず最初は以下のような空のテストメソッドを書きたくなることでしょう。
      </p><pre class="programlisting">public function testSomething()
{
}</pre><p>
      しかし、PHPUnit フレームワークでは空のメソッドを「成功した」
      と判断してしまうという問題があります。このような解釈ミスがあると、
      テスト結果のレポートが無意味になってしまいます。
      そのテストがほんとうに成功したのか、
      それともまだテストが実装されていないのかが判断できないからです。
      実装していないテストメソッドの中で <code class="literal">$this-&gt;fail()</code>
      をコールするようにしたところで事態は何も変わりません。
      こうすると、テストが「失敗した」と判断されてしまいます。
      これは未実装のテストが「成功」と判断されてしまうのと同じくらいまずいことです
      (訳注: レポートを見ても、そのテストがほんとうに失敗したのか、
      まだ実装されていないだけなのかがわかりません)。
    </p><p>
      <a id="idp299504" class="indexterm"></a>
      <a id="idp300048" class="indexterm"></a>
      <a id="idp300592" class="indexterm"></a>

      テストの成功を青信号、失敗を赤信号と考えるなら、
      テストが未完成あるいは未実装であることを表すための黄信号が必要です。
      そのような場合に使用するインターフェイスが
      <code class="literal">PHPUnit_Framework_IncompleteTest</code> で、
      これは未完成あるいは未実装のテストメソッドで発生する例外を表すものです。
      このインターフェイスの標準的な実装が
      <code class="literal">PHPUnit_Framework_IncompleteTestError</code> です。
    </p><p>
      <a class="xref" href="incomplete-and-skipped-tests.html#incomplete-and-skipped-tests.incomplete-tests.examples.SampleTest.php" title="例 7.1: テストに未完成の印をつける">例 7.1</a>
      では <code class="literal">SampleTest</code> というテストケースクラスを定義しています。
      便利なメソッド <code class="literal">markTestIncomplete()</code>
      (これは、自動的に <code class="literal">PHPUnit_Framework_IncompleteTestError</code>
      を発生させます) をテストメソッド内でコールすることで、
      このメソッドがまだ完成していないことをはっきりさせます。
    </p><div class="example"><a id="incomplete-and-skipped-tests.incomplete-tests.examples.SampleTest.php"></a><p class="title"><strong>例 7.1: テストに未完成の印をつける</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
class SampleTest extends PHPUnit_Framework_TestCase
{
    public function testSomething()
    {
        // オプション: お望みなら、ここで何かのテストをしてください。
        $this-&gt;assertTrue(TRUE, 'これは動いているはずです。');

        // ここで処理を止め、テストが未完成であるという印をつけます。
        $this-&gt;markTestIncomplete(
          'このテストは、まだ実装されていません。'
        );
    }
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      未完成のテストは、PHPUnit のコマンドライン版テストランナーでは以下のように
      <code class="literal">I</code> で表されます。
    </p><pre class="screen"><strong class="userinput"><code>phpunit --verbose SampleTest</code></strong>
PHPUnit 5.3.0 by Sebastian Bergmann and contributors.

I

Time: 0 seconds, Memory: 3.95Mb

There was 1 incomplete test:

1) SampleTest::testSomething
このテストは、まだ実装されていません。

/home/sb/SampleTest.php:12
OK, but incomplete or skipped tests!
Tests: 1, Assertions: 1, Incomplete: 1.</pre><p>
      <a class="xref" href="incomplete-and-skipped-tests.html#incomplete-and-skipped-tests.incomplete-tests.tables.api" title="表7.1 未完成のテスト用の API">表 7.1</a>
      に、テストを未完成扱いにするための API を示します。
    </p><div class="table"><a id="incomplete-and-skipped-tests.incomplete-tests.tables.api"></a><p class="title"><strong>表7.1 未完成のテスト用の API</strong></p><div class="table-contents"><table class="table" summary="未完成のテスト用の API" border="1"><colgroup><col></col><col></col></colgroup><thead><tr><th align="left">メソッド</th><th align="left">意味</th></tr></thead><tbody><tr><td align="left"><code class="literal" style="white-space: normal" id="markTestIncomplete">void markTestIncomplete()</code></td><td align="left">現在のテストを未完成扱いにします。</td></tr><tr><td align="left"><code class="literal" style="white-space: normal" id="markTestIncomplete">void markTestIncomplete(string $message)</code></td><td align="left">現在のテストを未完成扱いにします。それを説明する文字列として <code class="literal">$message</code> を使用します。</td></tr></tbody></table></div></div><br class="table-break"></br></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="incomplete-and-skipped-tests.skipping-tests"></a>テストの省略</h2></div></div></div><p>
      すべてのテストがあらゆる環境で実行できるわけではありません。
      考えてみましょう。たとえば、データベースの抽象化レイヤーを使用しており、
      それがさまざまなドライバを使用してさまざまなデータベースシステムを
      サポートしているとします。MySQL ドライバのテストができるのは、
      当然 MySQL サーバが使用できる環境だけです。
    </p><p>
      <a class="xref" href="incomplete-and-skipped-tests.html#incomplete-and-skipped-tests.skipping-tests.examples.DatabaseTest.php" title="例 7.2: テストを省略する">例 7.2</a>
      に示すテストケースクラス <code class="literal">DatabaseTest</code> には、
      テストメソッド <code class="literal">testConnection()</code> が含まれています。
      このクラスのテンプレートメソッド <code class="literal">setUp()</code> では、
      MySQLi 拡張モジュールが使用可能かを調べたうえで、もし使用できない場合は
      <code class="literal">markTestSkipped()</code> メソッドでテストを省略するようにしています。
    </p><div class="example"><a id="incomplete-and-skipped-tests.skipping-tests.examples.DatabaseTest.php"></a><p class="title"><strong>例 7.2: テストを省略する</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
class DatabaseTest extends PHPUnit_Framework_TestCase
{
    protected function setUp()
    {
        if (!extension_loaded('mysqli')) {
            $this-&gt;markTestSkipped(
              'MySQLi 拡張モジュールが使用できません。'
            );
        }
    }

    public function testConnection()
    {
        // ...
    }
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      飛ばされたテストは、PHPUnit のコマンドライン版テストランナーでは以下のように
      <code class="literal">S</code> で表されます。
    </p><pre class="screen"><strong class="userinput"><code>phpunit --verbose DatabaseTest</code></strong>
PHPUnit 5.3.0 by Sebastian Bergmann and contributors.

S

Time: 0 seconds, Memory: 3.95Mb

There was 1 skipped test:

1) DatabaseTest::testConnection
MySQLi 拡張モジュールが使用できません。

/home/sb/DatabaseTest.php:9
OK, but incomplete or skipped tests!
Tests: 1, Assertions: 0, Skipped: 1.</pre><p>
      <a class="xref" href="incomplete-and-skipped-tests.html#incomplete-and-skipped-tests.skipped-tests.tables.api" title="表7.2 テストを省略するための API">表 7.2</a>
      に、テストを省略するための API を示します。
    </p><div class="table"><a id="incomplete-and-skipped-tests.skipped-tests.tables.api"></a><p class="title"><strong>表7.2 テストを省略するための API</strong></p><div class="table-contents"><table class="table" summary="テストを省略するための API" border="1"><colgroup><col></col><col></col></colgroup><thead><tr><th align="left">メソッド</th><th align="left">意味</th></tr></thead><tbody><tr><td align="left"><code class="literal" style="white-space: normal" id="markTestSkipped">void markTestSkipped()</code></td><td align="left">現在のテストを省略扱いにします。</td></tr><tr><td align="left"><code class="literal" style="white-space: normal" id="markTestSkipped">void markTestSkipped(string $message)</code></td><td align="left">現在のテストを省略扱いにします。それを説明する文字列として <code class="literal">$message</code> を使用します。</td></tr></tbody></table></div></div><br class="table-break"></br></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="incomplete-and-skipped-tests.skipping-tests-using-requires"></a>@requires によるテストのスキップ</h2></div></div></div><p>
      ここまでに示したメソッドに加えて、
      <code class="literal">@requires</code> アノテーションを使って共通の事前条件を記述することもできます。
    </p><div class="table"><a id="incomplete-and-skipped-tests.requires.tables.api"></a><p class="title"><strong>表7.3 @requires の例用例</strong></p><div class="table-contents"><table class="table" summary="@requires の例用例" border="1"><colgroup><col></col><col></col><col></col><col></col></colgroup><thead><tr><th align="left">型</th><th align="left">取り得る値</th><th align="left">例</th><th align="left">別の例</th></tr></thead><tbody><tr><td align="left"><code class="literal">PHP</code></td><td align="left">PHP のバージョン</td><td align="left">@requires PHP 5.3.3</td><td align="left">@requires PHP 5.4-dev</td></tr><tr><td align="left"><code class="literal">PHPUnit</code></td><td align="left">PHPUnit のバージョン</td><td align="left">@requires PHPUnit 3.6.3</td><td align="left">@requires PHPUnit 4.6</td></tr><tr><td align="left"><code class="literal">OS</code></td><td align="left"><a class="ulink" href="http://php.net/manual/ja/reserved.constants.php#constant.php-os" target="_top">PHP_OS</a> にマッチする正規表現</td><td align="left">@requires OS Linux</td><td align="left">@requires OS WIN32|WINNT</td></tr><tr><td align="left"><code class="literal">function</code></td><td align="left"><a class="ulink" href="http://php.net/function_exists" target="_top">function_exists</a> に渡せるパラメータ</td><td align="left">@requires function imap_open</td><td align="left">@requires function ReflectionMethod::setAccessible</td></tr><tr><td align="left"><code class="literal">extension</code></td><td align="left">拡張モジュール名 (オプションでバージョンも指定できる)</td><td align="left">@requires extension mysqli</td><td align="left">@requires extension redis 2.2.0</td></tr></tbody></table></div></div><br class="table-break"></br><div class="example"><a id="incomplete-and-skipped-tests.skipping-tests.examples.DatabaseClassSkippingTest.php"></a><p class="title"><strong>例 7.3: @requires を使ったテストケースのスキップ</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
/**
 * @requires extension mysqli
 */
class DatabaseTest extends PHPUnit_Framework_TestCase
{
    /**
     * @requires PHP 5.3
     */
    public function testConnection()
    {
        // このテストには mysqli 拡張モジュールと PHP 5.3 以降が必須です
    }

    // ... その他のすべてのテストには mysqli 拡張モジュールが必須です
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      特定のバージョンの PHP でしか使えない構文を利用する場合は、
      <a class="xref" href="appendixes.configuration.html#appendixes.configuration.testsuites" title="テストスイート">「テストスイート」</a>
      にあるように XML 設定ファイルでのバージョン依存のインクルードを検討しましょう。
    </p></div></div>
     <div class="row">
      <div class="col-md-1 pull-left prev-nav"><a accesskey="p" href="strict-mode.html">戻る</a></div>
      <div class="col-md-1 pull-right next-nav"><a accesskey="n" href="database.html">次へ</a></div>
     </div>



    </div>
   </div>
   <hr/>
   <footer>
    <p><a href="appendixes.copyright.html">Copyright</a> &copy; 2005-2016 <a href="http://sebastian-bergmann.de/">Sebastian Bergmann</a>.</p>
   </footer>
  </div>
  <script src="js/jquery.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/highlight.pack.js"></script>
  <script type="text/javascript">
  $(document).ready(function() { $('pre.programlisting').each(function(i, e) {hljs.highlightBlock(e)}); });
  </script>
 </body>
</html>
