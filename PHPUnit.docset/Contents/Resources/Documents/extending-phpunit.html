<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <title>PHPUnit マニュアル &#8211; 第14章 PHPUnit の拡張</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="canonical" href="extending-phpunit.html">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/highlight.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <!--[if lt IE 9]><script src="js/html5shiv.min.js"></script><![endif]-->
 </head>
 <body>
  
  <div class="container-fluid">
   <div class="row">
    <div class="col-md-4 col-lg-3">
     <div class="well well-sm sidebar-nav">
<dl class="toc nav hidden-print"><dt><span class="chapter"><a href="installation.html">1. PHPUnit のインストール</a></span></dt><dd><dl><dt><span class="section"><a href="installation.html#installation.requirements">要件</a></span></dt><dt><span class="section"><a href="installation.html#installation.phar">PHP Archive (PHAR)</a></span></dt><dd><dl><dt><span class="section"><a href="installation.html#installation.phar.windows">Windows</a></span></dt><dt><span class="section"><a href="installation.html#installation.phar.verification">PHPUnit の PHAR リリースの検証</a></span></dt></dl></dd><dt><span class="section"><a href="installation.html#installation.composer">Composer</a></span></dt><dt><span class="section"><a href="installation.html#installation.optional-packages">オプションのパッケージ</a></span></dt></dl></dd><dt><span class="chapter"><a href="writing-tests-for-phpunit.html">2. PHPUnit 用のテストの書き方</a></span></dt><dd><dl><dt><span class="section"><a href="writing-tests-for-phpunit.html#writing-tests-for-phpunit.test-dependencies">テストの依存性</a></span></dt><dt><span class="section"><a href="writing-tests-for-phpunit.html#writing-tests-for-phpunit.data-providers">データプロバイダ</a></span></dt><dt><span class="section"><a href="writing-tests-for-phpunit.html#writing-tests-for-phpunit.exceptions">例外のテスト</a></span></dt><dt><span class="section"><a href="writing-tests-for-phpunit.html#writing-tests-for-phpunit.errors">PHP のエラーのテスト</a></span></dt><dt><span class="section"><a href="writing-tests-for-phpunit.html#writing-tests-for-phpunit.output">出力内容のテスト</a></span></dt><dt><span class="section"><a href="writing-tests-for-phpunit.html#writing-tests-for-phpunit.error-output">エラー出力</a></span></dt><dd><dl><dt><span class="section"><a href="writing-tests-for-phpunit.html#writing-tests-for-phpunit.error-output.edge-cases">エッジケース</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="textui.html">3. コマンドラインのテストランナー</a></span></dt><dd><dl><dt><span class="section"><a href="textui.html#textui.clioptions">コマンドラインオプション</a></span></dt></dl></dd><dt><span class="chapter"><a href="fixtures.html">4. フィクスチャ</a></span></dt><dd><dl><dt><span class="section"><a href="fixtures.html#fixtures.more-setup-than-teardown">tearDown() よりも setUp()</a></span></dt><dt><span class="section"><a href="fixtures.html#fixtures.variations">バリエーション</a></span></dt><dt><span class="section"><a href="fixtures.html#fixtures.sharing-fixture">フィクスチャの共有</a></span></dt><dt><span class="section"><a href="fixtures.html#fixtures.global-state">グローバルな状態</a></span></dt></dl></dd><dt><span class="chapter"><a href="organizing-tests.html">5. テストの構成</a></span></dt><dd><dl><dt><span class="section"><a href="organizing-tests.html#organizing-tests.filesystem">ファイルシステムを用いたテストスイートの構成</a></span></dt><dt><span class="section"><a href="organizing-tests.html#organizing-tests.xml-configuration">XML 設定ファイルを用いたテストスイートの構成</a></span></dt></dl></dd><dt><span class="chapter"><a href="risky-tests.html">6. リスクを伴うテスト</a></span></dt><dd><dl><dt><span class="section"><a href="risky-tests.html#risky-tests.useless-tests">無意味なテスト</a></span></dt><dt><span class="section"><a href="risky-tests.html#risky-tests.unintentionally-covered-code">意図せぬうちにカバーされているコード</a></span></dt><dt><span class="section"><a href="risky-tests.html#risky-tests.output-during-test-execution">テストの実行時の出力</a></span></dt><dt><span class="section"><a href="risky-tests.html#risky-tests.test-execution-timeout">テストの実行時のタイムアウト</a></span></dt><dt><span class="section"><a href="risky-tests.html#risky-tests.global-state-manipulation">グローバルな状態の変更</a></span></dt></dl></dd><dt><span class="chapter"><a href="incomplete-and-skipped-tests.html">7. 不完全なテスト・テストの省略</a></span></dt><dd><dl><dt><span class="section"><a href="incomplete-and-skipped-tests.html#incomplete-and-skipped-tests.incomplete-tests">不完全なテスト</a></span></dt><dt><span class="section"><a href="incomplete-and-skipped-tests.html#incomplete-and-skipped-tests.skipping-tests">テストの省略</a></span></dt><dt><span class="section"><a href="incomplete-and-skipped-tests.html#incomplete-and-skipped-tests.skipping-tests-using-requires">@requires によるテストのスキップ</a></span></dt></dl></dd><dt><span class="chapter"><a href="database.html">8. データベースのテスト</a></span></dt><dd><dl><dt><span class="section"><a href="database.html#database.supported-vendors-for-database-testing">データベースのテストに対応しているベンダー</a></span></dt><dt><span class="section"><a href="database.html#database.difficulties-in-database-testing">データベースのテストの難しさ</a></span></dt><dt><span class="section"><a href="database.html#database.the-four-stages-of-a-database-test">データベーステストの四段階</a></span></dt><dd><dl><dt><span class="section"><a href="database.html#database.clean-up-database">1. データベースのクリーンアップ</a></span></dt><dt><span class="section"><a href="database.html#database.set-up-fixture">2. フィクスチャの準備</a></span></dt><dt><span class="section"><a href="database.html#database.run-test-verify-outcome-and-teardown">3–5. テストの実行、結果の検証、そして後始末</a></span></dt></dl></dd><dt><span class="section"><a href="database.html#database.configuration-of-a-phpunit-database-testcase">PHPUnit のデータベーステストケースの設定</a></span></dt><dd><dl><dt><span class="section"><a href="database.html#database.implementing-getconnection">getConnection() の実装</a></span></dt><dt><span class="section"><a href="database.html#database.implementing-getdataset">getDataSet() の実装</a></span></dt><dt><span class="section"><a href="database.html#database.what-about-the-database-schema-ddl">データベーススキーマ (DDL) とは?</a></span></dt><dt><span class="section"><a href="database.html#database.tip-use-your-own-abstract-database-testcase">ヒント: 自前でのデータベーステストケースの抽象化</a></span></dt></dl></dd><dt><span class="section"><a href="database.html#database.understanding-datasets-and-datatables">データセットとデータテーブルについて知る</a></span></dt><dd><dl><dt><span class="section"><a href="database.html#database.available-implementations">利用できる実装</a></span></dt><dt><span class="section"><a href="database.html#database.beware-of-foreign-keys">外部キーには注意</a></span></dt><dt><span class="section"><a href="database.html#database.implementing-your-own-datasetsdatatables">自作のデータセットやデータテーブルの実装</a></span></dt></dl></dd><dt><span class="section"><a href="database.html#database.the-connection-api">接続 API</a></span></dt><dt><span class="section"><a href="database.html#database.database-assertions-api">データベースアサーション API</a></span></dt><dd><dl><dt><span class="section"><a href="database.html#database.asserting-the-row-count-of-a-table">テーブルの行数のアサーション</a></span></dt><dt><span class="section"><a href="database.html#database.asserting-the-state-of-a-table">テーブルの状態のアサーション</a></span></dt><dt><span class="section"><a href="database.html#database.asserting-the-result-of-a-query">クエリの結果のアサーション</a></span></dt><dt><span class="section"><a href="database.html#database.asserting-the-state-of-multiple-tables">複数のテーブルの状態のアサーション</a></span></dt></dl></dd><dt><span class="section"><a href="database.html#database.frequently-asked-questions">よくある質問</a></span></dt><dd><dl><dt><span class="section"><a href="database.html#database.will-phpunit-re-create-the-database-schema-for-each-test">PHPUnit は、テストごとにデータベーススキーマを作り直すの?</a></span></dt><dt><span class="section"><a href="database.html#database.am-i-required-to-use-pdo-in-my-application-for-the-database-extension-to-work">PDO を使ったアプリケーションじゃないと Database Extension を使えないの?</a></span></dt><dt><span class="section"><a href="database.html#database.what-can-i-do-when-i-get-a-too-much-connections-error"><span class="quote">「<span class="quote">Too much Connections</span>」</span> というエラーが出たらどうすればいい?</a></span></dt><dt><span class="section"><a href="database.html#database.how-to-handle-null-with-flat-xml-csv-datasets">フラット XML や CSV のデータセットで NULL を扱う方法は?</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="test-doubles.html">9. テストダブル</a></span></dt><dd><dl><dt><span class="section"><a href="test-doubles.html#test-doubles.stubs">スタブ</a></span></dt><dt><span class="section"><a href="test-doubles.html#test-doubles.mock-objects">モックオブジェクト</a></span></dt><dt><span class="section"><a href="test-doubles.html#test-doubles.prophecy">Prophecy</a></span></dt><dt><span class="section"><a href="test-doubles.html#test-doubles.mocking-traits-and-abstract-classes">トレイトと抽象クラスのモック</a></span></dt><dt><span class="section"><a href="test-doubles.html#test-doubles.stubbing-and-mocking-web-services">ウェブサービスのスタブおよびモック</a></span></dt><dt><span class="section"><a href="test-doubles.html#test-doubles.mocking-the-filesystem">ファイルシステムのモック</a></span></dt></dl></dd><dt><span class="chapter"><a href="testing-practices.html">10. テストの進め方</a></span></dt><dd><dl><dt><span class="section"><a href="testing-practices.html#testing-practices.during-development">開発中のテスト</a></span></dt><dt><span class="section"><a href="testing-practices.html#testing-practices.during-debugging">デバッグ中のテスト</a></span></dt></dl></dd><dt><span class="chapter"><a href="code-coverage-analysis.html">11. コードカバレッジ解析</a></span></dt><dd><dl><dt><span class="section"><a href="code-coverage-analysis.html#code-coverage-analysis.metrics">コードカバレッジの指標</a></span></dt><dt><span class="section"><a href="code-coverage-analysis.html#code-coverage-analysis.whitelisting-files">ファイルのホワイトリスト</a></span></dt><dt><span class="section"><a href="code-coverage-analysis.html#code-coverage-analysis.ignoring-code-blocks">コードブロックの無視</a></span></dt><dt><span class="section"><a href="code-coverage-analysis.html#code-coverage-analysis.specifying-covered-methods">カバーするメソッドの指定</a></span></dt><dt><span class="section"><a href="code-coverage-analysis.html#code-coverage-analysis.edge-cases">エッジケース</a></span></dt></dl></dd><dt><span class="chapter"><a href="other-uses-for-tests.html">12. テストのその他の使用法</a></span></dt><dd><dl><dt><span class="section"><a href="other-uses-for-tests.html#testing-practices.agile-documentation">アジャイルな文書作成</a></span></dt><dt><span class="section"><a href="other-uses-for-tests.html#testing-practices.cross-team-tests">複数チームでのテスト</a></span></dt></dl></dd><dt><span class="chapter"><a href="logging.html">13. ログ出力</a></span></dt><dd><dl><dt><span class="section"><a href="logging.html#logging.xml">テスト結果 (XML)</a></span></dt><dt><span class="section"><a href="logging.html#logging.codecoverage.xml">コードカバレッジ (XML)</a></span></dt><dt><span class="section"><a href="logging.html#logging.codecoverage.text">コードカバレッジ (テキスト)</a></span></dt></dl></dd><dt><span class="chapter"><a href="extending-phpunit.html" class="active">14. PHPUnit の拡張</a></span></dt><dd><dl><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit_Framework_TestCase">PHPUnit\Framework\TestCase のサブクラスの作成</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.custom-assertions">カスタムアサーションの作成</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit_Framework_TestListener">PHPUnit\Framework\TestListener の実装</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit_Extensions_TestDecorator">PHPUnit_Extensions_TestDecorator のサブクラスの作成</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit_Framework_Test">PHPUnit_Framework_Test の実装</a></span></dt></dl></dd><dt><span class="appendix"><a href="appendixes.assertions.html">A. アサーション</a></span></dt><dd><dl><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.static-vs-non-static-usage-of-assertion-methods">アサーションメソッドはstaticで使うべきか、それとも非staticで使うべきか</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertArrayHasKey">assertArrayHasKey()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertClassHasAttribute">assertClassHasAttribute()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertArraySubset">assertArraySubset()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertClassHasStaticAttribute">assertClassHasStaticAttribute()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertContains">assertContains()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertContainsOnly">assertContainsOnly()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertContainsOnlyInstancesOf">assertContainsOnlyInstancesOf()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertCount">assertCount()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertDirectoryExists">assertDirectoryExists()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertDirectoryIsReadable">assertDirectoryIsReadable()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertDirectoryIsWritable">assertDirectoryIsWritable()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertEmpty">assertEmpty()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertEqualXMLStructure">assertEqualXMLStructure()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertEquals">assertEquals()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertFalse">assertFalse()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertFileEquals">assertFileEquals()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertFileExists">assertFileExists()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertFileIsReadable">assertFileIsReadable()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertFileIsWritable">assertFileIsWritable()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertGreaterThan">assertGreaterThan()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertGreaterThanOrEqual">assertGreaterThanOrEqual()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertInfinite">assertInfinite()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertInstanceOf">assertInstanceOf()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertInternalType">assertInternalType()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertIsReadable">assertIsReadable()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertIsWritable">assertIsWritable()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertJsonFileEqualsJsonFile">assertJsonFileEqualsJsonFile()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertJsonStringEqualsJsonFile">assertJsonStringEqualsJsonFile()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertJsonStringEqualsJsonString">assertJsonStringEqualsJsonString()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertLessThan">assertLessThan()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertLessThanOrEqual">assertLessThanOrEqual()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertNan">assertNan()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertNull">assertNull()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertObjectHasAttribute">assertObjectHasAttribute()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertRegExp">assertRegExp()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertStringMatchesFormat">assertStringMatchesFormat()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertStringMatchesFormatFile">assertStringMatchesFormatFile()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertSame">assertSame()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertStringEndsWith">assertStringEndsWith()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertStringEqualsFile">assertStringEqualsFile()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertStringStartsWith">assertStringStartsWith()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertThat">assertThat()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertTrue">assertTrue()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertXmlFileEqualsXmlFile">assertXmlFileEqualsXmlFile()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertXmlStringEqualsXmlFile">assertXmlStringEqualsXmlFile()</a></span></dt><dt><span class="section"><a href="appendixes.assertions.html#appendixes.assertions.assertXmlStringEqualsXmlString">assertXmlStringEqualsXmlString()</a></span></dt></dl></dd><dt><span class="appendix"><a href="appendixes.annotations.html">B. アノテーション</a></span></dt><dd><dl><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.author">@author</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.after">@after</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.afterClass">@afterClass</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.backupGlobals">@backupGlobals</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.backupStaticAttributes">@backupStaticAttributes</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.before">@before</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.beforeClass">@beforeClass</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.codeCoverageIgnore">@codeCoverageIgnore*</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.covers">@covers</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.coversDefaultClass">@coversDefaultClass</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.coversNothing">@coversNothing</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.dataProvider">@dataProvider</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.depends">@depends</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.expectedException">@expectedException</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.expectedExceptionCode">@expectedExceptionCode</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.expectedExceptionMessage">@expectedExceptionMessage</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.expectedExceptionMessageRegExp">@expectedExceptionMessageRegExp</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.group">@group</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.large">@large</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.medium">@medium</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.preserveGlobalState">@preserveGlobalState</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.requires">@requires</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.runTestsInSeparateProcesses">@runTestsInSeparateProcesses</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.runInSeparateProcess">@runInSeparateProcess</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.small">@small</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.test">@test</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.testdox">@testdox</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.ticket">@ticket</a></span></dt><dt><span class="section"><a href="appendixes.annotations.html#appendixes.annotations.uses">@uses</a></span></dt></dl></dd><dt><span class="appendix"><a href="appendixes.configuration.html">C. XML 設定ファイル</a></span></dt><dd><dl><dt><span class="section"><a href="appendixes.configuration.html#appendixes.configuration.phpunit">PHPUnit</a></span></dt><dt><span class="section"><a href="appendixes.configuration.html#appendixes.configuration.testsuites">テストスイート</a></span></dt><dt><span class="section"><a href="appendixes.configuration.html#appendixes.configuration.groups">グループ</a></span></dt><dt><span class="section"><a href="appendixes.configuration.html#appendixes.configuration.whitelisting-files">コードカバレッジ対象のファイルのホワイトリスト</a></span></dt><dt><span class="section"><a href="appendixes.configuration.html#appendixes.configuration.logging">ログ出力</a></span></dt><dt><span class="section"><a href="appendixes.configuration.html#appendixes.configuration.test-listeners">テストリスナー</a></span></dt><dt><span class="section"><a href="appendixes.configuration.html#appendixes.configuration.php-ini-constants-variables">PHP INI 項目や定数、グローバル変数の設定</a></span></dt></dl></dd><dt><span class="appendix"><a href="appendixes.index.html">D. 目次</a></span></dt><dd><dl><dt><span class="index"><a href="appendixes.index.html#appendixes.index.index"></a></span></dt></dl></dd><dt><span class="appendix"><a href="appendixes.bibliography.html">E. 参考文献</a></span></dt><dt><span class="appendix"><a href="appendixes.copyright.html">F. 著作権</a></span></dt></dl>
     </div>
    </div>
    <div class="col-md-8 col-lg-9">
     <div class="row">
      <div class="col-md-1 pull-left prev-nav"><a accesskey="p" href="logging.html">戻る</a></div>
      <div class="col-md-1 pull-right next-nav"><a accesskey="n" href="appendixes.assertions.html">次へ</a></div>
     </div>
<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="extending-phpunit"></a>第14章 PHPUnit の拡張</h1></div></div></div><p>
    テストを書きやすくする、あるいはテストの実行結果の表示方法を変更するなど、
    PHPUnit はさまざまな方法で拡張することができます。
    PHPUnit を拡張するための第一歩をここで説明します。
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit_Framework_TestCase"></a>PHPUnit\Framework\TestCase のサブクラスの作成</h2></div></div></div><p>
      <a id="idp862576" class="indexterm"></a>

      <code class="literal">PHPUnit\Framework\TestCase</code>
      を継承した抽象サブクラスにカスタムアサーションやユーティリティメソッドを書き、
      そのクラスをさらに継承してテストクラスを作成します。
      これが、PHPUnit を拡張するための一番簡単な方法です。
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.custom-assertions"></a>カスタムアサーションの作成</h2></div></div></div><p>
      カスタムアサーションを作成するときには、PHPUnit 自体のアサーションの実装方法を真似るのがおすすめです。
      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.Assert.php" title="例 14.1: PHPUnit_Framework_Assert クラスの assertTrue() および isTrue() メソッド">例 14.1</a> を見ればわかるとおり、
      <code class="literal">assertTrue()</code> メソッドは
      <code class="literal">isTrue()</code> および <code class="literal">assertThat()</code> メソッドの単なるラッパーに過ぎません。
      <code class="literal">isTrue()</code> が matcher オブジェクトを作り、それを
      <code class="literal">assertThat()</code> に渡して評価しています。
    </p><div class="example"><a id="extending-phpunit.examples.Assert.php"></a><p class="title"><strong>例 14.1: PHPUnit_Framework_Assert クラスの assertTrue() および isTrue() メソッド</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
use PHPUnit\Framework\TestCase;

abstract class PHPUnit_Framework_Assert
{
    // ...

    /**
     * Asserts that a condition is true.
     *
     * @param  boolean $condition
     * @param  string  $message
     * @throws PHPUnit_Framework_AssertionFailedError
     */
    public static function assertTrue($condition, $message = '')
    {
        self::assertThat($condition, self::isTrue(), $message);
    }

    // ...

    /**
     * Returns a PHPUnit_Framework_Constraint_IsTrue matcher object.
     *
     * @return PHPUnit_Framework_Constraint_IsTrue
     * @since  Method available since Release 3.3.0
     */
    public static function isTrue()
    {
        return new PHPUnit_Framework_Constraint_IsTrue;
    }

    // ...
}?&gt;</pre></div></div><br class="example-break"></br><p>
      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.IsTrue.php" title="例 14.2: PHPUnit_Framework_Constraint_IsTrue クラス">例 14.2</a> は、
      <code class="literal">PHPUnit_Framework_Constraint_IsTrue</code> が
      matcher オブジェクト (あるいは制約) のために抽象クラス
      <code class="literal">PHPUnit_Framework_Constraint</code> を継承している部分です。
    </p><div class="example"><a id="extending-phpunit.examples.IsTrue.php"></a><p class="title"><strong>例 14.2: PHPUnit_Framework_Constraint_IsTrue クラス</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
use PHPUnit\Framework\TestCase;

class PHPUnit_Framework_Constraint_IsTrue extends PHPUnit_Framework_Constraint
{
    /**
     * Evaluates the constraint for parameter $other. Returns true if the
     * constraint is met, false otherwise.
     *
     * @param mixed $other Value or object to evaluate.
     * @return bool
     */
    public function matches($other)
    {
        return $other === true;
    }

    /**
     * Returns a string representation of the constraint.
     *
     * @return string
     */
    public function toString()
    {
        return 'is true';
    }
}?&gt;</pre></div></div><br class="example-break"></br><p>
      <code class="literal">assertTrue()</code> や
      <code class="literal">isTrue()</code> メソッドの実装を
      <code class="literal">PHPUnit_Framework_Constraint_IsTrue</code> クラスと同じようにしておけば、
      アサーションの評価やタスクの記録 (テストの統計情報に自動的に更新するなど)
      を <code class="literal">assertThat()</code> が自動的に行ってくれるようになります。
      さらに、モックオブジェクトを設定する際の matcher として <code class="literal">isTrue()</code>
      メソッドを使えるようにもなります。
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit_Framework_TestListener"></a>PHPUnit\Framework\TestListener の実装</h2></div></div></div><p>
      <a id="idp879520" class="indexterm"></a>

      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.SimpleTestListener.php" title="例 14.3: シンプルなテストリスナー">例 14.3</a> は、
      <code class="literal">PHPUnit\Framework\TestListener</code>
      インターフェイスのシンプルな実装例です。
    </p><div class="example"><a id="extending-phpunit.examples.SimpleTestListener.php"></a><p class="title"><strong>例 14.3: シンプルなテストリスナー</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
use PHPUnit\Framework\TestCase;
use PHPUnit\Framework\TestListener;

class SimpleTestListener implements TestListener
{
    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
    {
        printf("テスト '%s' の実行中にエラーが発生\n", $test-&gt;getName());
    }

    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
    {
        printf("テスト '%s' に失敗\n", $test-&gt;getName());
    }

    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
    {
        printf("テスト '%s' は未完成\n", $test-&gt;getName());
    }

    public function addRiskyTest(PHPUnit_Framework_Test $test, Exception $e, $time)
    {
        printf("テスト '%s' は危険\n", $test-&gt;getName());
    }

    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
    {
        printf("テスト '%s' をスキップ\n", $test-&gt;getName());
    }

    public function startTest(PHPUnit_Framework_Test $test)
    {
        printf("テスト '%s' が開始\n", $test-&gt;getName());
    }

    public function endTest(PHPUnit_Framework_Test $test, $time)
    {
        printf("テスト '%s' が終了\n", $test-&gt;getName());
    }

    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)
    {
        printf("テストスイート '%s' が開始\n", $suite-&gt;getName());
    }

    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
    {
        printf("テストスイート '%s' が終了\n", $suite-&gt;getName());
    }
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      <a id="idp884832" class="indexterm"></a>

      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.BaseTestListener.php" title="例 14.4: ベーステストリスナーの利用法">例 14.4</a>
      は、抽象クラス <code class="literal">PHPUnit_Framework_BaseTestListener</code>
      のサブクラスを作る例です。これは、インターフェイスのメソッドのうち実際に使うものだけを指定し、
      他のメソッドについては空の実装を提供します。
    </p><div class="example"><a id="extending-phpunit.examples.BaseTestListener.php"></a><p class="title"><strong>例 14.4: ベーステストリスナーの利用法</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
use PHPUnit\Framework\TestCase;

class ShortTestListener extends PHPUnit_Framework_BaseTestListener
{
    public function endTest(PHPUnit_Framework_Test $test, $time)
    {
        printf("テスト '%s' が終了\n", $test-&gt;getName());
    }
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      <a class="xref" href="appendixes.configuration.html#appendixes.configuration.test-listeners" title="テストリスナー">「テストリスナー」</a>
      に、自作のテストリスナーをテスト実行時にアタッチするための
      PHPUnit の設定方法についての説明があります。
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit_Extensions_TestDecorator"></a>PHPUnit_Extensions_TestDecorator のサブクラスの作成</h2></div></div></div><p>
      <a id="idp891504" class="indexterm"></a>

      <code class="literal">PHPUnit_Extensions_TestDecorator</code>
      のサブクラスでテストケースあるいはテストスイートをラッピングし、
      デコレータパターンを使用することで
      各テストの実行前後に何らかの処理をさせることができます。
    </p><p>
      <a id="idp893248" class="indexterm"></a>
      <a id="idp893840" class="indexterm"></a>

      PHPUnit には、<code class="literal">PHPUnit_Extensions_RepeatedTest</code>
      および <code class="literal">PHPUnit_Extensions_TestSetup</code>
      という 2 つの具象テストデコレータが付属しています。
      前者はテストを繰り返し実行し、それらが全て成功した場合にのみ成功とみなします。
      後者については <a class="xref" href="fixtures.html" title="第4章 フィクスチャ">第 4 章</a> で説明しました。
    </p><p>
      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.RepeatedTest.php" title="例 14.5: RepeatedTest デコレータ">例 14.5</a>
      は、テストデコレータ <code class="literal">PHPUnit_Extensions_RepeatedTest</code>
      の一部を抜粋したものです。独自のデコレータを作成するための参考にしてください。
    </p><div class="example"><a id="extending-phpunit.examples.RepeatedTest.php"></a><p class="title"><strong>例 14.5: RepeatedTest デコレータ</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
use PHPUnit\Framework\TestCase;

require_once 'PHPUnit/Extensions/TestDecorator.php';

class PHPUnit_Extensions_RepeatedTest extends PHPUnit_Extensions_TestDecorator
{
    private $timesRepeat = 1;

    public function __construct(PHPUnit_Framework_Test $test, $timesRepeat = 1)
    {
        parent::__construct($test);

        if (is_integer($timesRepeat) &amp;&amp;
            $timesRepeat &gt;= 0) {
            $this-&gt;timesRepeat = $timesRepeat;
        }
    }

    public function count()
    {
        return $this-&gt;timesRepeat * $this-&gt;test-&gt;count();
    }

    public function run(PHPUnit_Framework_TestResult $result = null)
    {
        if ($result === null) {
            $result = $this-&gt;createResult();
        }

        for ($i = 0; $i &lt; $this-&gt;timesRepeat &amp;&amp; !$result-&gt;shouldStop(); $i++) {
            $this-&gt;test-&gt;run($result);
        }

        return $result;
    }
}
?&gt;</pre></div></div><br class="example-break"></br></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit_Framework_Test"></a>PHPUnit_Framework_Test の実装</h2></div></div></div><p>
      <a id="idp1401488" class="indexterm"></a>
      <a id="idp1402064" class="indexterm"></a>

      <code class="literal">PHPUnit_Framework_Test</code> インターフェイスの機能は限られており、
      実装するのは簡単です。<code class="literal">PHPUnit_Framework_Test</code>
      を実装するのは <code class="literal">PHPUnit\Framework\TestCase</code> の実装より単純で、
      これを用いて例えば <span class="emphasis"><em>データ駆動のテスト (data-driven tests)</em></span>
      などを実行します。
    </p><p>
      カンマ区切り (CSV) ファイルの値と比較する、データ駆動のテストを
      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.DataDrivenTest.php" title="例 14.6: データ駆動のテスト">例 14.6</a>
      に示します。このファイルの各行は <code class="literal">foo;bar</code>
      のような形式になっており (訳注: CSV じゃない……)、
      最初の値が期待値で 2 番目の値が実際の値です。
    </p><div class="example"><a id="extending-phpunit.examples.DataDrivenTest.php"></a><p class="title"><strong>例 14.6: データ駆動のテスト</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
use PHPUnit\Framework\TestCase;

class DataDrivenTest implements PHPUnit_Framework_Test
{
    private $lines;

    public function __construct($dataFile)
    {
        $this-&gt;lines = file($dataFile);
    }

    public function count()
    {
        return 1;
    }

    public function run(PHPUnit_Framework_TestResult $result = null)
    {
        if ($result === null) {
            $result = new PHPUnit_Framework_TestResult;
        }

        foreach ($this-&gt;lines as $line) {
            $result-&gt;startTest($this);
            PHP_Timer::start();
            $stopTime = null;

            list($expected, $actual) = explode(';', $line);

            try {
                PHPUnit_Framework_Assert::assertEquals(
                  trim($expected), trim($actual)
                );
            }

            catch (PHPUnit_Framework_AssertionFailedError $e) {
                $stopTime = PHP_Timer::stop();
                $result-&gt;addFailure($this, $e, $stopTime);
            }

            catch (Exception $e) {
                $stopTime = PHP_Timer::stop();
                $result-&gt;addError($this, $e, $stopTime);
            }

            if ($stopTime === null) {
                $stopTime = PHP_Timer::stop();
            }

            $result-&gt;endTest($this, $stopTime);
        }

        return $result;
    }
}

$test = new DataDrivenTest('data_file.csv');
$result = PHPUnit_TextUI_TestRunner::run($test);
?&gt;</pre><pre class="screen">PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

.F

Time: 0 seconds

There was 1 failure:

1) DataDrivenTest
Failed asserting that two strings are equal.
expected string &lt;bar&gt;
difference      &lt;  x&gt;
got string      &lt;baz&gt;
/home/sb/DataDrivenTest.php:32
/home/sb/DataDrivenTest.php:53

FAILURES!
Tests: 2, Failures: 1.</pre></div></div><br class="example-break"></br></div></div>
     <div class="row">
      <div class="col-md-1 pull-left prev-nav"><a accesskey="p" href="logging.html">戻る</a></div>
      <div class="col-md-1 pull-right next-nav"><a accesskey="n" href="appendixes.assertions.html">次へ</a></div>
     </div>

   </div>
   <hr/>
   <footer>
    <p><a href="appendixes.copyright.html">Copyright</a> &copy; 2005-2017 <a href="http://sebastian-bergmann.de/">Sebastian Bergmann</a>.</p>
   </footer>
  </div>
  <script src="js/jquery.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/highlight.pack.js"></script>
  <script type="text/javascript">
  $(document).ready(function() { $('pre.programlisting').each(function(i, e) {hljs.highlightBlock(e)}); });
  </script>
 </body>
</html>
